# çœèµ›åµŒå…¥å¼æµ‹è¯•é¡¹ç›® - å¿«é€Ÿå‚è€ƒæ‰‹å†Œ

> è¿™æ˜¯ä¸€ä»½å¿«é€Ÿå‚è€ƒæŒ‡å—ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿä¸Šæ‰‹ç¼–å†™ç±»ä¼¼çš„æµ‹è¯•ç”¨ä¾‹

---

## ğŸš€ å¿«é€Ÿå¼€å§‹æ¨¡æ¿

### æœ€å°æµ‹è¯•è„šæœ¬æ¨¡æ¿
```lua
function entry()
    -- 1. æ¸…ç©ºé€šé“
    clear(channels.Sensor)
    
    -- 2. å‘é€æ•°æ®
    write_msg(channels.Sensor, protocols.P_Sensor, {temprature = 20})
    
    -- 3. å»¶æ—¶ç­‰å¾…
    etimer.delay(1000)
    
    -- 4. è¯»å–å“åº”
    local res = read_buff(channels.Heater, 0, 1000)
    
    -- 5. è§£ææ•°æ®
    local pkg = unpack(protocols.P_Heater, ebuff.from_buff(res.value), true)
    
    -- 6. éªŒè¯ç»“æœ
    if pkg then
        check(pkg.value.voltage > 0, "ç”µå‹æ­£å¸¸", "ç”µå‹å¼‚å¸¸")
    end
    
    -- 7. é€€å‡º
    exit()
end
```

### æ•°æ®é©±åŠ¨æµ‹è¯•æ¨¡æ¿
```lua
function entry()
    -- éå†æµ‹è¯•æ•°æ®
    for idx, item in ipairs(test_data.Frames) do
        -- å‘é€è¾“å…¥
        write_msg(channels.Sensor, protocols.P_Sensor, {
            temprature = item.input
        })
        
        -- éªŒè¯è¾“å‡º
        etimer.delay(1000)
        local res = read_buff(channels.Heater, 0, 1000)
        local pkg = unpack(protocols.P_Heater, ebuff.from_buff(res.value), true)
        
        if pkg then
            check(pkg.value.voltage == item.expect, 
                  "ç¬¬"..idx.."æ¬¡æµ‹è¯•é€šè¿‡", 
                  "ç¬¬"..idx.."æ¬¡æµ‹è¯•å¤±è´¥")
        end
    end
    
    exit()
end
```

### å¼‚æ­¥æ¥æ”¶æ¨¡æ¿
```lua
local count = 0
local max_count = 5

function on_receive(ch, res)
    count = count + 1
    
    local pkg = unpack(protocols.P_Fan, res.value, true)
    if pkg then
        print("ç¬¬"..count.."æ¬¡æ¥æ”¶:", pkg.value.cmd)
    end
    
    if count >= max_count then
        off_recv(channels.Fan)
        exit()
    end
end

function entry()
    -- æ³¨å†Œå›è°ƒ
    on_buff_recv(channels.Fan, on_receive)
    
    -- è§¦å‘æµ‹è¯•
    for i = 1, max_count do
        write_msg(channels.Sensor, protocols.P_Sensor, {temprature = i * 10})
        etimer.delay(1500)
    end
end
```

---

## ğŸ“‹ APIé€ŸæŸ¥è¡¨

### é€šé“æ“ä½œ
| API | è¯´æ˜ | ç¤ºä¾‹ |
|-----|------|------|
| `clear(channel)` | æ¸…ç©ºç¼“å†²åŒº | `clear(channels.Sensor)` |
| `write_msg(ch, prot, data)` | å‘é€æ¶ˆæ¯ | `write_msg(channels.Sensor, protocols.P_Sensor, {temprature=20})` |
| `write_msg_sync(ch, prot, data)` | åŒæ­¥å‘é€ | `write_msg_sync(channels.Sensor, protocols.P_Sensor, {temprature=20})` |
| `read_buff(ch, offset, timeout)` | è¯»å–æ•°æ® | `res = read_buff(channels.Heater, 0, 1000)` |
| `on_buff_recv(ch, callback)` | æ³¨å†Œå›è°ƒ | `on_buff_recv(channels.Fan, function(ch,res) end)` |
| `off_recv(ch)` | å–æ¶ˆå›è°ƒ | `off_recv(channels.Fan)` |

### åè®®æ“ä½œ
| API | è¯´æ˜ | ç¤ºä¾‹ |
|-----|------|------|
| `pack(prot, data)` | æ‰“åŒ… | `data = pack(protocols.P_Fan, {cmd=1})` |
| `unpack(prot, buff, flag)` | è§£åŒ… | `pkg = unpack(protocols.P_Heater, ebuff.from_buff(data), true)` |
| `ebuff.from_buff(data)` | è½¬æ¢ç¼“å†²åŒº | `ebuff.from_buff(res.value)` |

### æ ¡éªŒè®¡ç®—
| API | è¯´æ˜ | ç¤ºä¾‹ |
|-----|------|------|
| `require("e_checker")` | å¼•å…¥æ¨¡å— | æ–‡ä»¶å¼€å¤´è°ƒç”¨ä¸€æ¬¡ |
| `e_checker.SUM_8(buf, off, bits)` | SUM_8æ ¡éªŒ | `e_checker.SUM_8(ebuff.from_buff(data), 3, 56)` |

### æ–­è¨€éªŒè¯
| API | è¯´æ˜ | ç¤ºä¾‹ |
|-----|------|------|
| `check(cond, pass, fail)` | æ–­è¨€ | `check(value==10, "æ­£ç¡®", "é”™è¯¯")` |
| `step(desc, exp, act, cond)` | æ­¥éª¤ | `step("éªŒè¯ç”µå‹", "5V", "4.8V", false)` |
| `ask(type, opts)` | è¯¢é—® | `passed = ask('yesno', {title='æç¤º', msg='æ˜¯å¦é€šè¿‡?'})` |

### å®šæ—¶å™¨
| API | è¯´æ˜ | ç¤ºä¾‹ |
|-----|------|------|
| `etimer.delay(ms)` | å»¶æ—¶ | `etimer.delay(1000)` -- å»¶æ—¶1ç§’ |
| `etimer.now()` | å½“å‰æ—¶é—´ | `t = etimer.now()` |

### æ§åˆ¶æµç¨‹
| API | è¯´æ˜ | ç¤ºä¾‹ |
|-----|------|------|
| `exit()` | é€€å‡ºæµ‹è¯• | `exit()` -- å¿…é¡»åœ¨entry()ç»“æŸå‰è°ƒç”¨ |

---

## ğŸ”Œ åè®®å­—æ®µé€ŸæŸ¥

### æ¸©åº¦ä¼ æ„Ÿå™¨åè®® (P_Sensor)
```lua
-- å‘é€
write_msg(channels.Sensor, protocols.P_Sensor, {
    temprature = 25.5  -- æ¸©åº¦å€¼ (float)
    -- ä»¥ä¸‹å­—æ®µé€šå¸¸ä½¿ç”¨autoValueè‡ªåŠ¨å¡«å……
    -- header = 0xFFFA
    -- datatype1 = 0x01
    -- datatype2 = 0x10
    -- dataLen = 0x04
    -- check = è‡ªåŠ¨è®¡ç®—
    -- tail = 0x0F
})

-- æ¥æ”¶å¹¶è§£åŒ…
local pkg = unpack(protocols.P_Sensor, buffer, true)
if pkg then
    print(pkg.value.header)      -- 0xFFFA
    print(pkg.value.temprature)  -- 25.5
    print(pkg.value.check)       -- æ ¡éªŒå’Œ
end
```

### åŠ çƒ­æ£’åè®® (P_Heater)
```lua
-- æ¥æ”¶å¹¶è§£åŒ…
local res = read_buff(channels.Heater, 0, 1000)
local pkg = unpack(protocols.P_Heater, ebuff.from_buff(res.value), true)
if pkg then
    print(pkg.value.header)      -- 0xFFFA
    print(pkg.value.datatype1)   -- 0x02
    print(pkg.value.datatype2)   -- 0x11
    print(pkg.value.datalen)     -- 0x04
    print(pkg.value.voltage)     -- è¾“å‡ºç”µå‹ (float)
    print(pkg.value.check)       -- æ ¡éªŒå’Œ
    print(pkg.value.tail)        -- 0x0F
end
```

### æ•£çƒ­é£æ‰‡åè®® (P_Fan)
```lua
-- æ¥æ”¶å¹¶è§£åŒ…
local res = read_buff(channels.Fan, 0, 1000)
local pkg = unpack(protocols.P_Fan, ebuff.from_buff(res.value), true)
if pkg then
    print(pkg.value.header)      -- 0xFFFA
    print(pkg.value.datatype1)   -- 0x02
    print(pkg.value.datatype2)   -- 0x22
    print(pkg.value.datalen)     -- 0x01
    print(pkg.value.cmd)         -- 0=åœæ­¢, 1=å¯åŠ¨
    print(pkg.value.check)       -- æ ¡éªŒå’Œ
    print(pkg.value.tail)        -- 0x0F
end
```

---

## ğŸ“Š æµ‹è¯•æ•°æ® (YAML) æ ¼å¼

### æ•°ç»„æ ¼å¼
```yaml
Frames:
  - input: 10
    expect: 0.5
    desc: "ç¬¬ä¸€ç»„æµ‹è¯•"
  - input: 20
    expect: 1.0
    desc: "ç¬¬äºŒç»„æµ‹è¯•"
  - input: 30
    expect: 1.5
    desc: "ç¬¬ä¸‰ç»„æµ‹è¯•"
```

**è®¿é—®æ–¹å¼**:
```lua
for idx, item in ipairs(test_data.Frames) do
    print(item.input)   -- 10, 20, 30
    print(item.expect)  -- 0.5, 1.0, 1.5
    print(item.desc)    -- æè¿°
end
```

### é”®å€¼å¯¹æ ¼å¼
```yaml
# æ³¨é‡Š
temp_low: 5
temp_high: 50
threshold: 10
enabled: true
```

**è®¿é—®æ–¹å¼**:
```lua
print(test_data.temp_low)    -- 5
print(test_data.temp_high)   -- 50
print(test_data.threshold)   -- 10
print(test_data.enabled)     -- true
```

---

## ğŸ› ï¸ å¸¸è§æµ‹è¯•åœºæ™¯ä»£ç ç‰‡æ®µ

### 1. æ¥å£å­—æ®µéªŒè¯
```lua
require("e_checker")

function entry()
    -- å‘é€æµ‹è¯•æ•°æ®
    write_msg(channels.Sensor, protocols.P_Sensor, {temprature = 20})
    
    -- è¯»å–å“åº”
    local res = read_buff(channels.Heater, 0, 1000)
    local data = res.value
    local pkg = unpack(protocols.P_Heater, ebuff.from_buff(data), true)
    
    if pkg then
        -- éªŒè¯å›ºå®šå­—æ®µ
        check(pkg.value.header == 0xFFFA, "åŒ…å¤´æ­£ç¡®", "åŒ…å¤´é”™è¯¯")
        check(pkg.value.datatype1 == 0x02, "æ•°æ®ç±»å‹1æ­£ç¡®", "æ•°æ®ç±»å‹1é”™è¯¯")
        check(pkg.value.datatype2 == 0x11, "æ•°æ®ç±»å‹2æ­£ç¡®", "æ•°æ®ç±»å‹2é”™è¯¯")
        check(pkg.value.tail == 0x0F, "åŒ…å°¾æ­£ç¡®", "åŒ…å°¾é”™è¯¯")
        
        -- éªŒè¯æ ¡éªŒå’Œ
        local checkVal = e_checker.SUM_8(ebuff.from_buff(data), 3, 56)
        check(pkg.value.check == checkVal, "æ ¡éªŒå’Œæ­£ç¡®", "æ ¡éªŒå’Œé”™è¯¯")
    end
    
    exit()
end
```

### 2. è¾¹ç•Œå€¼æµ‹è¯•
```lua
function entry()
    local boundary_values = {-22, -21, -20, 0, 50, 51, 52}
    
    for _, temp in ipairs(boundary_values) do
        write_msg(channels.Sensor, protocols.P_Sensor, {temprature = temp})
        etimer.delay(500)
        
        -- è§‚å¯Ÿæˆ–éªŒè¯å“åº”
        print("è¾“å…¥æ¸©åº¦:", temp)
    end
    
    exit()
end
```

### 3. æ—¶åºæµ‹è¯•
```lua
function entry()
    local times = {}
    
    -- è®°å½•10æ¬¡è¾“å‡ºçš„æ—¶é—´æˆ³
    on_buff_recv(channels.Heater, function(ch, res)
        table.insert(times, etimer.now())
        
        if #times >= 10 then
            -- è®¡ç®—æ—¶é—´é—´éš”
            for i = 2, #times do
                local interval = times[i] - times[i-1]
                print("é—´éš”", i-1, ":", interval, "ms")
                
                -- éªŒè¯1.2ç§’Â±3% (1164~1236ms)
                check(interval >= 1164 and interval <= 1236, 
                      "æ—¶åºæ­£ç¡®", 
                      "æ—¶åºé”™è¯¯:"..interval.."ms")
            end
            
            off_recv(channels.Heater)
            exit()
        end
    end)
    
    -- æŒç»­å‘é€æ•°æ®
    for i = 1, 15 do
        write_msg(channels.Sensor, protocols.P_Sensor, {temprature = 10})
        etimer.delay(1500)
    end
end
```

### 4. é”™è¯¯æ•°æ®åŒ…æµ‹è¯•
```lua
function entry()
    -- æµ‹è¯•é”™è¯¯çš„æ•°æ®ç±»å‹1
    local res = write_msg(channels.Sensor, protocols.P_Sensor, {
        temprature = 11,
        datatype1 = 0x02  -- é”™è¯¯å€¼ï¼Œåº”ä¸º0x01
    })
    
    etimer.delay(500)
    
    -- è¯¢é—®ç”¨æˆ·è§‚å¯Ÿ
    local passed = ask('yesno', {
        title = 'æç¤º',
        msg = 'ç•Œé¢æ˜¯å¦æ˜¾ç¤º11åº¦ï¼Ÿï¼ˆåº”è¯¥ä¸æ˜¾ç¤ºï¼‰',
        default = true
    })
    
    check(not passed, "æ­£ç¡®ä¸¢åŒ…", "æœªä¸¢åŒ…")
    
    exit()
end
```

### 5. è¿ç»­æ¡ä»¶åˆ¤æ–­æµ‹è¯•
```lua
local count = 0

function on_fan_data(ch, res)
    local pkg = unpack(protocols.P_Fan, res.value, true)
    if pkg then
        count = count + 1
        
        -- ç¬¬4æ¬¡æ¥æ”¶æ—¶éªŒè¯ï¼ˆå› ä¸ºç¬¬1æ¬¡æ˜¯åˆå§‹çŠ¶æ€ï¼‰
        if count == 4 then
            local expected_cmd = 0  -- åº”è¯¥åœæ­¢
            check(pkg.value.cmd == expected_cmd, 
                  "é£æ‰‡æ­£ç¡®åœæ­¢", 
                  "é£æ‰‡çŠ¶æ€é”™è¯¯")
            off_recv(channels.Fan)
            exit()
        end
    end
end

function entry()
    on_buff_recv(channels.Fan, on_fan_data)
    
    -- å‘é€3æ¬¡ä½æ¸©ï¼ˆ<=è®¾å®šæ¸©åº¦ï¼‰
    write_msg_sync(channels.Sensor, protocols.P_Sensor, {temprature = 8})
    etimer.delay(1500)
    write_msg_sync(channels.Sensor, protocols.P_Sensor, {temprature = 9})
    etimer.delay(1500)
    write_msg_sync(channels.Sensor, protocols.P_Sensor, {temprature = 7})
    etimer.delay(1500)
end
```

### 6. PIDè¾“å‡ºéªŒè¯
```lua
function calculate_pid(temps, target, idx)
    local Kp, Ki, Kd = 0.05, 0.1, 0.1
    local ek = target - temps[idx]
    local ek1 = idx > 1 and (target - temps[idx-1]) or 0
    local ek2 = idx > 2 and (target - temps[idx-2]) or 0
    
    return Kp * (ek - ek1) + Ki * ek + Kd * (ek - 2*ek1 + ek2)
end

function entry()
    local temps = {5, 8, 12, 6, 9}
    local target = 10
    local voltage = 0
    
    on_buff_recv(channels.Heater, function(ch, res)
        local pkg = unpack(protocols.P_Heater, res.value, true)
        if pkg then
            print("å®é™…ç”µå‹:", pkg.value.voltage)
        end
    end)
    
    for i, temp in ipairs(temps) do
        write_msg_sync(channels.Sensor, protocols.P_Sensor, {temprature = temp})
        
        local delta_v = calculate_pid(temps, target, i)
        voltage = voltage + delta_v
        if voltage < 0 then voltage = 0 end
        
        print("ç¬¬"..i.."æ¬¡ - æœŸæœ›ç”µå‹:", voltage)
        etimer.delay(1500)
    end
    
    off_recv(channels.Heater)
    exit()
end
```

---

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. æ‰“å°è°ƒè¯•
```lua
-- æ‰“å°å˜é‡
print("temperature:", temp)

-- æ‰“å°è¡¨ï¼ˆå­—å…¸ï¼‰å†…å®¹
for k, v in pairs(pkg.value) do
    print(k, "=", v)
end

-- æ‰“å°æ—¶é—´æˆ³
print("å½“å‰æ—¶é—´:", etimer.now())
```

### 2. æ•°æ®åŒ…è°ƒè¯•
```lua
-- æ‰“åŒ…åæ£€æŸ¥
local data = pack(protocols.P_Sensor, {temprature = 20})
print("æ•°æ®åŒ…é•¿åº¦:", #data.value)

-- è§£åŒ…æ£€æŸ¥
local pkg = unpack(protocols.P_Heater, ebuff.from_buff(data), true)
if pkg then
    print("è§£åŒ…æˆåŠŸ")
else
    print("è§£åŒ…å¤±è´¥")
end
```

### 3. å›è°ƒè°ƒè¯•
```lua
function on_receive(ch, res)
    print("æ”¶åˆ°æ•°æ®ï¼Œé•¿åº¦:", #res.value)
    
    local pkg = unpack(protocols.P_Fan, res.value, true)
    if pkg then
        print("è§£åŒ…æˆåŠŸ")
        for k, v in pairs(pkg.value) do
            print("  ", k, "=", v)
        end
    else
        print("è§£åŒ…å¤±è´¥")
    end
end
```

### 4. å¸¸è§é”™è¯¯æ’æŸ¥

| ç—‡çŠ¶ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ³• |
|------|---------|---------|
| è§£åŒ…å¤±è´¥ | åè®®ä¸åŒ¹é… | æ£€æŸ¥åè®®å®šä¹‰å’Œå®é™…æ•°æ® |
| æ”¶ä¸åˆ°æ•°æ® | é€šé“ç»‘å®šé”™è¯¯ | æ£€æŸ¥ä»¿çœŸç¯å¢ƒ.envé…ç½® |
| æ ¡éªŒå’Œé”™è¯¯ | è®¡ç®—èŒƒå›´é”™è¯¯ | æ£€æŸ¥offsetå’ŒbitCountå‚æ•° |
| æ—¶åºä¸å¯¹ | å»¶æ—¶ä¸è¶³ | å¢åŠ etimer.delayæ—¶é—´ |
| å›è°ƒä¸è§¦å‘ | æœªæ³¨å†Œæˆ–å·²å–æ¶ˆ | æ£€æŸ¥on_buff_recvè°ƒç”¨ |
| è„šæœ¬å¡æ­» | å¿˜è®°exit() | ç¡®ä¿æ‰€æœ‰è·¯å¾„éƒ½è°ƒç”¨exit() |

---

## ğŸ“ æ–°å»ºæµ‹è¯•ç”¨ä¾‹æ£€æŸ¥æ¸…å•

### æ–‡ä»¶åˆ›å»º
- [ ] åˆ›å»º `XX_æµ‹è¯•åç§°.lua` æµ‹è¯•è„šæœ¬
- [ ] åˆ›å»º `XX_æµ‹è¯•åç§°.yml` æµ‹è¯•æ•°æ®ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] åˆ›å»º `XX_æµ‹è¯•åç§°.run` æ‰§è¡Œé…ç½®
- [ ] æ›´æ–°åè®®æ–‡ä»¶ï¼ˆå¦‚éœ€è¦æ–°åè®®ï¼‰

### è„šæœ¬å†…å®¹
- [ ] å®šä¹‰ `function entry()` å…¥å£å‡½æ•°
- [ ] æ‰€æœ‰è·¯å¾„éƒ½è°ƒç”¨ `exit()`
- [ ] ä½¿ç”¨ `local` å£°æ˜å±€éƒ¨å˜é‡
- [ ] å›è°ƒå‡½æ•°é…å¯¹ä½¿ç”¨ `on_buff_recv` å’Œ `off_recv`
- [ ] æ·»åŠ è¶³å¤Ÿçš„ `etimer.delay()` ç­‰å¾…å“åº”
- [ ] ä½¿ç”¨ `check()` æˆ– `step()` éªŒè¯ç»“æœ

### æµ‹è¯•æ•°æ®
- [ ] YAMLæ ¼å¼æ­£ç¡®ï¼ˆæ³¨æ„ç¼©è¿›ï¼‰
- [ ] å­—æ®µåä¸Luaè„šæœ¬ä¸­è®¿é—®çš„ä¸€è‡´
- [ ] åŒ…å«è¶³å¤Ÿçš„æµ‹è¯•æ•°æ®è¦†ç›–è¾¹ç•Œå€¼

### æ‰§è¡Œé…ç½®
- [ ] envValue æŒ‡å‘æ­£ç¡®çš„ä»¿çœŸç¯å¢ƒæ–‡ä»¶
- [ ] luaVal æŒ‡å‘æ­£ç¡®çš„æµ‹è¯•è„šæœ¬
- [ ] yamlVal å’Œ netvar æŒ‡å‘æ­£ç¡®çš„æµ‹è¯•æ•°æ®
- [ ] protocolList åŒ…å«æ‰€æœ‰éœ€è¦çš„åè®®
- [ ] æ‰€æœ‰åè®® checked è®¾ç½®ä¸º true

### æµ‹è¯•éªŒè¯
- [ ] è„šæœ¬èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œå®Œæˆ
- [ ] æ‰€æœ‰æ–­è¨€éƒ½ç¬¦åˆé¢„æœŸ
- [ ] æ²¡æœ‰Luaè¿è¡Œæ—¶é”™è¯¯
- [ ] æµ‹è¯•ç»“æœå¯é‡ç°
- [ ] åœ¨é—®é¢˜æŠ¥å‘Šä¸­è®°å½•äº†å‘ç°çš„é—®é¢˜

---

## ğŸ¯ é—®é¢˜æŠ¥å‘Šè®°å½•è¦ç‚¹

### å¿…å¡«ä¿¡æ¯
1. **éœ€æ±‚ç¼–å·**: å¦‚ 2.1, 3.2
2. **æµ‹è¯•ç”¨ä¾‹æè¿°**: æ¸…æ™°è¯´æ˜æµ‹è¯•ç›®æ ‡
3. **è¾“å…¥**: å…·ä½“çš„æµ‹è¯•æ•°æ®
4. **é¢„æœŸè¾“å‡º**: æ ¹æ®éœ€æ±‚æ–‡æ¡£çš„æœŸæœ›ç»“æœ
5. **å®é™…è¾“å‡º**: å®é™…è§‚å¯Ÿåˆ°çš„ç»“æœ
6. **é—®é¢˜æè¿°**: è¯¦ç»†æè¿°é—®é¢˜ç°è±¡å’Œå½±å“

### å¯é€‰ä¿¡æ¯
- é‡ç°æ­¥éª¤
- æµ‹è¯•è„šæœ¬åç§°
- é—®é¢˜ç­‰çº§ï¼ˆé«˜/ä¸­/ä½ï¼‰
- æˆªå›¾æˆ–æ—¥å¿—
- ä¿®å¤å»ºè®®

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä»£ç é£æ ¼
```lua
-- å¥½çš„å®è·µï¼šæ¸…æ™°çš„å˜é‡å
local received_count = 0
local expected_voltage = 5.0

-- ä¸å¥½çš„å®è·µï¼šå«ç³Šçš„å˜é‡å
local n = 0
local v = 5.0
```

### 2. é”™è¯¯å¤„ç†
```lua
-- å¥½çš„å®è·µï¼šæ£€æŸ¥è§£åŒ…ç»“æœ
local pkg = unpack(protocols.P_Heater, buffer, true)
if pkg then
    -- è®¿é—®å­—æ®µ
    print(pkg.value.voltage)
else
    print("è§£åŒ…å¤±è´¥")
end

-- ä¸å¥½çš„å®è·µï¼šä¸æ£€æŸ¥ç›´æ¥è®¿é—®
local pkg = unpack(protocols.P_Heater, buffer, true)
print(pkg.value.voltage)  -- å¯èƒ½å‡ºé”™
```

### 3. è¶…æ—¶è®¾ç½®
```lua
-- æ ¹æ®å®é™…æƒ…å†µè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
-- ç³»ç»Ÿå¾ªç¯å‘¨æœŸä¸º1.2ç§’ï¼Œæ‰€ä»¥è‡³å°‘ç­‰å¾…1.5ç§’
local res = read_buff(channels.Heater, 0, 1500)
```

### 4. èµ„æºæ¸…ç†
```lua
function entry()
    -- æ³¨å†Œå›è°ƒ
    on_buff_recv(channels.Fan, callback)
    
    -- ... æµ‹è¯•ä»£ç  ...
    
    -- ç¡®ä¿å–æ¶ˆå›è°ƒ
    off_recv(channels.Fan)
    
    exit()
end
```

### 5. æ³¨é‡Šè¯´æ˜
```lua
-- è™½ç„¶ç¤ºä¾‹é¡¹ç›®ä¸­æ³¨é‡Šä¸å¤šï¼Œä½†å»ºè®®æ·»åŠ å…³é”®æ³¨é‡Š
function entry()
    -- 1. åˆå§‹åŒ–ï¼šæ¸…ç©ºç¼“å†²åŒº
    clear(channels.Sensor)
    
    -- 2. æµ‹è¯•ï¼šå‘é€è¾¹ç•Œå€¼
    for _, temp in ipairs({-20, 0, 50}) do
        write_msg(channels.Sensor, protocols.P_Sensor, {temprature = temp})
        etimer.delay(1500)
    end
    
    -- 3. æ¸…ç†ï¼šé€€å‡ºæµ‹è¯•
    exit()
end
```

---

## ğŸ”— ç›¸å…³æ–‡ä»¶å‚è€ƒ

- **å®Œæ•´åˆ†ææŠ¥å‘Š**: `çœèµ›é¡¹ç›®åˆ†ææŠ¥å‘Š.md`
- **é—®é¢˜æŠ¥å‘Šç¤ºä¾‹**: `çœèµ›_é—®é¢˜æŠ¥å‘Š.md`
- **é¡¹ç›®æ–‡ä»¶ä½ç½®**: `çœèµ›/project/`
- **åè®®å®šä¹‰**: `çœèµ›/project/åè®®/`
- **æµ‹è¯•è„šæœ¬**: `çœèµ›/project/æµ‹è¯•è„šæœ¬/`
- **æµ‹è¯•æ•°æ®**: `çœèµ›/project/æµ‹è¯•æ•°æ®/`
- **æ‰§è¡Œé…ç½®**: `çœèµ›/project/æ‰§è¡Œé…ç½®/`

---

**ç‰ˆæœ¬**: 1.0  
**æ›´æ–°æ—¥æœŸ**: 2024-11-14  
**é€‚ç”¨é¡¹ç›®**: CST2024åµŒå…¥å¼åˆ†èµ›æµ‹è¯•

> ğŸ’ª æ˜å¤©åŠ æ²¹ï¼ç›¸ä¿¡ä½ èƒ½å†™å‡ºä¼˜ç§€çš„æµ‹è¯•ç”¨ä¾‹ï¼
