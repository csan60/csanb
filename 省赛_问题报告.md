# CST2024嵌入式分赛 - 温度控制器测试问题报告

**项目名称**: 温度控制器系统测试  
**被测软件**: SensorControl.exe  
**测试日期**: 2024年  
**报告版本**: 1.0

---

## 问题汇总表

| 序号 | 需求编号 | 问题等级 | 问题描述摘要 | 状态 |
|------|----------|----------|--------------|------|
| 1 | 2.1 | 高 | 散热风扇初始状态为开启，应为停止 | 待修复 |
| 2 | 2.2 | 高 | 循环控制时间间隔误差超过3% | 待修复 |
| 3 | 2.3 | 中 | 温度下边界(-20℃)未截断处理 | 待修复 |
| 4 | 2.4 | 高 | 加热棒输出电压值计算错误 | 待修复 |
| 5 | 2.5 | 高 | 散热风扇连续检测逻辑错误 | 待修复 |
| 6 | 3.1 | 中 | 数据类型1错误时未做丢包处理 | 待修复 |
| 7 | 3.2 | 高 | 加热棒输出数据类型2字段错误 | 待修复 |
| 8 | 3.3 | 中 | 散热风扇输出校验字段字节序错误 | 待修复 |

---

## 问题详细描述

### 问题1: 散热风扇初始状态错误

| 项目 | 内容 |
|------|------|
| **需求编号** | 2.1 |
| **问题等级** | 🔴 高 |
| **测试用例描述** | 系统启动，测试散热风扇初始状态是否为停止状态 |
| **测试输入** | 启动温度控制器，观察散热风扇的初始状态情况 |
| **预期输出** | 温度控制器中散热风扇初始状态为停止状态（cmd=0） |
| **实际输出** | 温度控制器中散热风扇初始状态为开启状态（cmd=1） |
| **问题描述** | 散热风扇的初始状态为开启状态，不是停止状态。根据需求，系统启动时散热风扇应处于停止状态，但实际测试发现系统启动后散热风扇立即开启。 |
| **影响范围** | 影响系统初始化流程，可能导致不必要的能耗和系统行为异常 |
| **重现步骤** | 1. 启动SensorControl.exe<br>2. 监听散热风扇输出通道<br>3. 观察初始输出指令的cmd字段 |
| **测试脚本** | 测试脚本/01_温度采集处理.lua |
| **附件** | 无 |
| **备注** | 问题1 - 需要检查初始化代码中的风扇状态设置 |

---

### 问题2: 循环控制时间间隔不准确

| 项目 | 内容 |
|------|------|
| **需求编号** | 2.2 |
| **问题等级** | 🔴 高 |
| **测试用例描述** | 测试温度控制器是否以1.2秒(误差小于3%)为间隔循环进行采集温度和输出加热棒信号和散热风扇控制信号 |
| **测试输入** | 连续输入多个温度信息如-20，-15，-10,0,10，15,25,35,45,50等，观察输出的控制指令 |
| **预期输出** | 温度控制器以1.2秒为间隔循环进行采集温度和输出<br>误差范围: 1.164秒 ~ 1.236秒（±3%） |
| **实际输出** | 输出指令时间间隔不是1.2秒且误差大于3% |
| **问题描述** | 温度控制器输出指令时间间隔不符合1.2秒±3%的要求。测试中发现实际时间间隔波动较大，超出允许误差范围，影响控制系统的稳定性和准确性。 |
| **影响范围** | 严重影响PID控制算法的效果，可能导致温控不稳定 |
| **重现步骤** | 1. 启动温度控制器<br>2. 持续发送温度数据<br>3. 记录每次输出指令的时间戳<br>4. 计算相邻输出的时间差 |
| **测试脚本** | 测试脚本/06_系统循环控制.lua<br>测试脚本/11_测试1边界值测试.lua |
| **附件** | 时序图（如有） |
| **备注** | 问题2 - 建议检查定时器精度和任务调度逻辑 |

---

### 问题3: 温度下边界未截断处理

| 项目 | 内容 |
|------|------|
| **需求编号** | 2.3 |
| **问题等级** | 🟡 中 |
| **测试用例描述** | 测试温度控制器的温度采集和处理功能能否对下边界进行截断处理 |
| **测试输入** | 输入温度-21℃和-22℃ |
| **预期输出** | 显示输入的温度为-20℃（截断到下边界） |
| **实际输出** | 显示输入的温度为-21℃和-22℃（未截断） |
| **问题描述** | 温度控制器的温度采集处理功能未对超出下边界（-20℃）的温度值进行截断处理。根据需求，温度采集范围为-20℃~50℃，超出范围的值应截断到边界值。 |
| **影响范围** | 可能导致后续PID计算使用非法温度值，影响控制精度 |
| **重现步骤** | 1. 发送温度传感器数据，温度值设置为-21℃<br>2. 观察界面显示的采集温度<br>3. 重复测试-22℃，-25℃等 |
| **测试脚本** | 测试脚本/01_温度采集处理.lua |
| **测试数据** | 测试数据/01_温度采集处理.yml |
| **附件** | 无 |
| **备注** | 问题3 - 同时需要测试上边界（50℃）的截断处理 |

---

### 问题4: 加热棒输出电压值计算错误

| 项目 | 内容 |
|------|------|
| **需求编号** | 2.4 |
| **问题等级** | 🔴 高 |
| **测试用例描述** | 测试在温度控制器给定温度时，加热棒5次的输出电压值 |
| **测试输入** | 在温度控制器中设定温度为10℃，依次输入温度：2.81℃, 50℃, 9.1℃, 5℃, 1.6℃ |
| **预期输出** | 根据PID算法计算得出当前输出时刻的电压值<br>PID参数: Kp=0.05, Ki=0.1, Kd=0.1 |
| **实际输出** | 当前输出时刻的电压值与预期不符 |
| **问题描述** | 在温度控制器中设定温度加热棒输出功能输出的电压值不正确。测试发现实际输出电压与基于增量式PID算法计算的理论值存在偏差，可能是PID参数设置错误或算法实现有误。 |
| **影响范围** | 核心控制算法错误，严重影响温控效果 |
| **PID算法** | ΔV = Kp×(ek-ek1) + Ki×ek + Kd×(ek-2×ek1+ek2)<br>V(k) = V(k-1) + ΔV<br>其中: ek = Td - T(k) |
| **重现步骤** | 1. 设定目标温度为10℃<br>2. 按序列发送温度数据<br>3. 读取每次加热棒输出电压<br>4. 与理论计算值对比 |
| **测试脚本** | 测试脚本/07_加热棒输出.lua |
| **附件** | PID计算对比表（如有） |
| **备注** | 问题8 - 需要详细检查PID实现代码 |

---

### 问题5: 散热风扇连续检测逻辑错误

| 项目 | 内容 |
|------|------|
| **需求编号** | 2.5 |
| **问题等级** | 🔴 高 |
| **测试用例描述** | 测试当温度控制器连续检测不足3次且当前温度小于等于设定温度时，散热风扇是否停止转动 |
| **测试输入** | 在温度控制器中设定温度为10℃，且当前散热风扇为开启状态下，输入一次10℃，再输入两次11℃或12℃ |
| **预期输出** | 当前散热风扇维持开启状态（因为没有连续3次温度≤设定温度） |
| **实际输出** | 当前散热风扇变为停止状态 |
| **问题描述** | 检测到1次当前温度小于等于设定的温度时，散热风扇就停止转动。根据需求，应连续检测到3次当前温度小于等于设定温度时，散热风扇才停止转动。 |
| **影响范围** | 散热风扇过早关闭，可能导致温度过冲 |
| **需求逻辑** | - 当前温度 > 设定温度 → 散热风扇启动<br>- 连续3次检测到当前温度 ≤ 设定温度 → 散热风扇停止<br>- 中间有任何一次不满足条件，计数器清零 |
| **重现步骤** | 1. 设定温度为10℃<br>2. 确保风扇处于开启状态（发送温度>10℃）<br>3. 发送10℃（第1次≤10℃）<br>4. 发送11℃（不满足条件，应清零）<br>5. 观察风扇状态 |
| **测试脚本** | 测试脚本/03_散热风散输出.lua |
| **测试数据** | 测试数据/03_散热风散输出.yml |
| **附件** | 无 |
| **备注** | 问题4 - 需要检查连续检测计数器的实现 |

---

### 问题6: 数据类型1错误时未做丢包处理

| 项目 | 内容 |
|------|------|
| **需求编号** | 3.1 |
| **问题等级** | 🟡 中 |
| **测试用例描述** | 当界面采集温度不等于11度时，测试温度传感器输入接口处理是否正确，当输入的数据包的"数据类型1"错误时，软件是否采取丢包处理 |
| **测试输入** | 输入的数据包的"数据类型1"设置为0x02（应为0x01），校验位正确 |
| **预期输出** | 温度控制器中不显示采集到数据，软件做丢包处理 |
| **实际输出** | 温度控制器中显示到采集的数据 |
| **问题描述** | 测试温度传感器输入接口处理时，当输入的数据包的"数据类型1"字段错误时，软件没有采取丢包处理。系统应该在接收到错误的数据类型字段时，丢弃该数据包，但实际上系统仍然处理了该数据。 |
| **影响范围** | 数据包校验不严格，可能接收错误数据导致系统异常 |
| **协议规范** | 温度传感器协议:<br>- datatype1: 必须为0x01<br>- datatype2: 必须为0x10<br>- 不符合协议规范的数据包应丢弃 |
| **重现步骤** | 1. 构造数据包，设置temprature=11℃<br>2. 修改datatype1为0x02<br>3. 重新计算校验和（保证校验通过）<br>4. 发送数据包<br>5. 观察界面显示 |
| **测试脚本** | 测试脚本/04_接口温度传感器输入.lua<br>测试脚本/13_测试3.lua |
| **附件** | 无 |
| **备注** | 问题5 - 同时需要测试datatype2错误、包头错误等情况 |

---

### 问题7: 加热棒输出数据类型2字段错误

| 项目 | 内容 |
|------|------|
| **需求编号** | 3.2 |
| **问题等级** | 🔴 高 |
| **测试用例描述** | 当界面采集温度不等于11度时，测试温度控制器中加热棒输出接口输出数据的"数据类型2"字段是否正确 |
| **测试输入** | 输入温度传感器数据并读取加热棒输出数据 |
| **预期输出** | 输出的"数据类型2"字段为0x11 |
| **实际输出** | 输出的"数据类型2"字段为0x10 |
| **问题描述** | 温度控制器的加热棒输出接口输出数据的"数据类型2"字段出现错误。根据协议规范，加热棒输出协议的datatype2应为0x11，但实际输出为0x10。 |
| **影响范围** | 协议不符合规范，下游设备可能无法正确识别 |
| **协议规范** | 加热棒协议:<br>- header: 0xFFFA<br>- datatype1: 0x02<br>- datatype2: 0x11 ❌ (实际输出0x10)<br>- datalen: 0x04<br>- voltage: float |
| **重现步骤** | 1. 发送温度传感器数据（温度≠11℃）<br>2. 读取加热棒输出通道数据<br>3. 解析数据包<br>4. 检查datatype2字段值 |
| **测试脚本** | 测试脚本/02_接口_加热棒输出.lua |
| **附件** | 数据包抓包记录（如有） |
| **备注** | 问题6 - 协议字段硬编码错误 |

---

### 问题8: 散热风扇输出校验字段字节序错误

| 项目 | 内容 |
|------|------|
| **需求编号** | 3.3 |
| **问题等级** | 🟡 中 |
| **测试用例描述** | 当界面采集温度不等于11度时，测试温度控制器中散热风扇输出接口的校验字段是否正确 |
| **测试输入** | 输入温度传感器数据并读取散热风扇输出数据 |
| **预期输出** | 输出的校验字段值为小端字节序 |
| **实际输出** | 输出的校验字段为大端字节序 |
| **问题描述** | 温度控制器的散热风扇输出接口的校验字段输出的字节序错误。根据协议规范，校验和字段应为小端字节序（低字节在前），但实际输出为大端字节序（高字节在前）。 |
| **影响范围** | 校验失败，接收方无法正确验证数据完整性 |
| **协议规范** | 散热风扇协议校验字段:<br>- 类型: uint16<br>- 算法: SUM_8（8位累加，16位输出）<br>- 字节序: 小端（Little Endian）❌ (实际为大端) |
| **示例** | 假设校验和计算结果为0x1234:<br>- 正确输出: 0x34 0x12（小端）<br>- 错误输出: 0x12 0x34（大端） |
| **重现步骤** | 1. 发送温度传感器数据<br>2. 读取散热风扇输出数据<br>3. 手工计算校验和<br>4. 对比数据包中的校验字段字节序 |
| **测试脚本** | 测试脚本/08_接口散热风扇输出.lua |
| **附件** | 字节序对比示例 |
| **备注** | 问题7 - 需检查pack函数的字节序参数 |

---

## 性能测试结果

### 温控稳定时间测试

| 测试场景 | 设定温度 | 外部温度 | 稳定时间 | 性能要求 | 结果 |
|---------|---------|---------|---------|---------|------|
| 场景1 | 10℃ | 0℃ | ~30秒 | ≤60秒 | ✅ 通过 |
| 场景2 | 20℃ | 10℃ | ~30秒 | ≤60秒 | ✅ 通过 |
| 场景3 | 20℃ | 0℃ | ~29秒 | ≤60秒 | ✅ 通过 |

**稳定判定标准**: 连续10个周期（12秒）内温度偏差 < 1℃

**测试脚本**: 测试脚本/05_性能_温控稳定时间性能需求_1.lua

---

## 测试环境信息

| 项目 | 信息 |
|------|------|
| 被测软件 | SensorControl.exe |
| 测试框架 | Lua脚本自动化测试框架 |
| 通信接口 | 串口RS232 (波特率115200) |
| 操作系统 | Windows |
| 测试工具版本 | V4 |
| 测试执行日期 | 2024年 |

---

## 问题统计

### 按等级统计
- 🔴 **高**: 5个（62.5%）
- 🟡 **中**: 3个（37.5%）
- 🟢 **低**: 0个（0%）

### 按模块统计
- **功能逻辑**: 5个（问题1,2,3,4,5）
- **接口协议**: 3个（问题6,7,8）

### 按需求分类
- **2.1 初始状态**: 1个
- **2.2 循环控制**: 1个
- **2.3 数据处理**: 1个
- **2.4 PID控制**: 1个
- **2.5 逻辑判断**: 1个
- **3.1 输入校验**: 1个
- **3.2 输出协议**: 1个
- **3.3 数据格式**: 1个

---

## 修复建议

### 优先级1（高优先级，立即修复）
1. **问题2** - 修复循环控制定时器，确保1.2秒±3%的精度
2. **问题4** - 检查并修正PID算法实现
3. **问题5** - 修复散热风扇连续检测计数器逻辑
4. **问题7** - 修改加热棒协议datatype2字段为0x11

### 优先级2（中优先级，尽快修复）
5. **问题1** - 修改散热风扇初始状态为停止（cmd=0）
6. **问题3** - 添加温度边界截断逻辑（-20℃~50℃）
7. **问题6** - 添加输入数据包的协议字段校验
8. **问题8** - 修正散热风扇输出校验字段字节序

---

## 测试覆盖率

根据覆盖率得分.png显示的测试覆盖情况：
- ✅ 功能需求覆盖率: 100%
- ✅ 接口协议覆盖率: 100%
- ✅ 边界值测试覆盖率: 100%
- ✅ 性能需求覆盖率: 100%

---

## 附录：测试用例清单

| 编号 | 测试脚本 | 需求编号 | 测试内容 | 状态 |
|------|---------|---------|---------|------|
| 01 | 01_温度采集处理.lua | 2.3 | 温度边界截断 | ❌ 失败 |
| 02 | 02_接口_加热棒输出.lua | 3.2 | 加热棒协议 | ❌ 失败 |
| 03 | 03_散热风散输出.lua | 2.5 | 风扇逻辑 | ❌ 失败 |
| 04 | 04_接口温度传感器输入.lua | 3.1 | 传感器协议 | ❌ 失败 |
| 05 | 05_性能_温控稳定时间性能需求_1.lua | 性能 | 稳定时间 | ✅ 通过 |
| 06 | 06_系统循环控制.lua | 2.2 | 循环周期 | ❌ 失败 |
| 07 | 07_加热棒输出.lua | 2.4 | PID控制 | ❌ 失败 |
| 08 | 08_接口散热风扇输出.lua | 3.3 | 风扇协议 | ❌ 失败 |
| 11 | 11_测试1边界值测试.lua | 综合 | 边界值 | ❌ 失败 |
| 12 | 12_测试2.lua | 综合 | 基本功能 | - 待定 |
| 13 | 13_测试3.lua | 3.1 | 错误处理 | ❌ 失败 |

**测试通过率**: 9% (1/11)

---

## 报告审批

| 角色 | 姓名 | 签名 | 日期 |
|------|------|------|------|
| 测试工程师 | | | |
| 测试负责人 | | | |
| 项目经理 | | | |

---

**报告生成日期**: 2024-11-14  
**报告版本**: 1.0  
**下次更新计划**: 问题修复后进行回归测试
