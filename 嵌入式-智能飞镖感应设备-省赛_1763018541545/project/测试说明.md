# 智能飞镖感应设备测试套件说明

## 📋 测试概述

本测试套件专为智能飞镖感应设备设计，全面覆盖系统功能、接口校验、得分逻辑、状态机和异常处理等关键测试点。

**测试时间**: 2025年  
**测试框架**: Lua脚本 + YAML数据配置  
**测试目标**: 发现并验证系统中的10大典型问题

---

## 🎯 测试用例清单

### 1. 飞镖信息输入测试 (`1shoot.lua`)
**测试文件**: `func/1shoot.lua`  
**运行配置**: `run/1shoot.run`  
**测试目标**: 验证飞镖信息输入功能的基本正确性

**测试内容**:
- ✅ 轻型飞镖信息输入（type=1）
- ✅ 重型飞镖信息输入（type=2）
- ✅ 不同数量的飞镖输入
- ✅ 系统是否正确接收并显示飞镖信息

**覆盖需求**: 2.2 飞镖信息输入功能

---

### 2. 靶区信息接收测试 (`2target.lua`)
**测试文件**: `func/2target.lua`  
**运行配置**: `run/2target.run`  
**测试目标**: 验证靶区信息接收功能的基本正确性

**测试内容**:
- ✅ 内牛眼区域（zone=1）
- ✅ 三倍区（zone=5）
- ✅ 中间区域（zone=10）
- ✅ 外侧区域（zone=15）
- ✅ 边界区域（zone=20）
- ✅ 多个不同区域的连续测试

**覆盖需求**: 2.3 靶区信息接收功能

---

### 3. 数据传送机接口校验 (`3interface_shoot.lua`)
**测试文件**: `func/3interface_shoot.lua`  
**运行配置**: `run/3interface_shoot.run`  
**测试目标**: 验证COM接口1的数据包校验能力

**测试内容**:
- ✅ 包头错误测试（0x5511 vs 正确的0xAA55）
- ✅ 包尾错误测试（0xAA55 vs 正确的0x55AA）
- ✅ 数据标志错误测试（0xCC vs 正确的0xBB）
- ✅ 正常数据包对照测试

**覆盖需求**: 3.1 数据传送机接口校验  
**覆盖问题**: 3.1-001 (校验错误数据帧未被丢弃)

---

### 4. 靶体接口校验 (`4interface_target.lua`)
**测试文件**: `func/4interface_target.lua`  
**运行配置**: `run/4interface_target.run`  
**测试目标**: 验证COM接口2的数据包校验能力

**测试内容**:
- ✅ 包头错误测试
- ✅ 包尾错误测试
- ✅ 数据标志1错误测试（0xBB vs 正确的0xCC）
- ✅ 数据标志2错误测试（0x22 vs 正确的0x11）
- ✅ 区域边界值测试（zone=0, zone=21）
- ✅ 正常数据包对照测试

**覆盖需求**: 3.2 靶体接口校验  
**覆盖问题**: 3.2-001 (区域数据包字段非法仍被接收)

---

### 5. 得分逻辑测试 (`5scoring_test.lua`) ⭐ 新增
**测试文件**: `func/5scoring_test.lua`  
**运行配置**: `run/5scoring_test.run`  
**测试目标**: 验证不同飞镖类型和区域的得分计算

**测试内容**:
- 🎯 轻镖命中内牛眼（5分） - **问题2.4-001**
- 🎯 轻镖命中外牛眼（3分）
- 🎯 轻镖命中三倍区（2分）
- 🎯 重镖命中内牛眼（3分）
- 🎯 重镖命中三倍区（2分） - **问题2.4-002**
- 🎯 普通区域得分（1分）

**覆盖需求**: 2.4 得分逻辑  
**覆盖问题**:
- ❌ 2.4-001: 轻镖命中"内牛眼"得分错误（只加3分，应为5分）
- ❌ 2.4-002: 重镖命中"三倍区"得分错误（只加1分，应为2分）

---

### 6. 状态机测试 (`6state_machine_test.lua`) ⭐ 新增
**测试文件**: `func/6state_machine_test.lua`  
**运行配置**: `run/6state_machine_test.run`  
**测试目标**: 验证系统状态机的正确性

**测试内容**:
- 🔄 非准备状态下输入飞镖 - **问题2.2-002**
- 🔄 点击开始后倒计时启动 - **问题2.3-001**
- 🔄 时间结束后拒绝得分信息 - **问题2.5-001**
- 🔄 非结束状态下点击复位 - **问题2.6-001**
- 🔄 正常状态流转测试

**覆盖需求**: 2.2, 2.3, 2.5, 2.6  
**覆盖问题**:
- ❌ 2.2-002: 非"准备投镖"状态仍能接收飞镖输入
- ❌ 2.3-001: 点击"开始"后无倒计时启动
- ❌ 2.5-001: 时间结束后仍接收得分信息
- ❌ 2.6-001: 非"投镖结束"状态下点击"复位"仍清空数据

---

### 7. 成绩评定测试 (`7performance_test.lua`) ⭐ 新增
**测试文件**: `func/7performance_test.lua`  
**运行配置**: `run/7performance_test.run`  
**测试目标**: 验证成绩评定分区的正确性

**测试内容**:
- 📊 优秀评定测试（平均 >= 2.5分）
- 📊 良好评定测试（2.5 > 平均 >= 2.0分） - **问题2.5-002**
- 📊 差评定测试（平均 < 2.0分）
- 📊 边界值评定测试（平均 = 2.5分）

**覆盖需求**: 2.5 成绩评定  
**覆盖问题**:
- ❌ 2.5-002: 成绩评定分区错误（轻镖平均2分显示为"差"，应为"良"）

---

### 8. 异常数据处理测试 (`8exception_test.lua`) ⭐ 新增
**测试文件**: `func/8exception_test.lua`  
**运行配置**: `run/8exception_test.run`  
**测试目标**: 验证系统对异常数据的处理能力

**测试内容**:
- ⚠️ 飞镖数量为nil - **问题2.2-003**
- ⚠️ 非法飞镖类型（type=99）
- ⚠️ 负数飞镖数量（number=-5）
- ⚠️ 区域值为0 - **问题3.2-001**
- ⚠️ 区域值超出范围（zone=21） - **问题3.2-001**
- ⚠️ 负数区域值（zone=-1）
- ⚠️ 校验和错误 - **问题3.1-001**
- ⚠️ 极端值测试（number=999）

**覆盖需求**: 数据校验、异常处理  
**覆盖问题**:
- ❌ 2.2-003: 飞镖数量字段为nil时系统崩溃
- ❌ 3.1-001: 校验错误数据帧未被丢弃
- ❌ 3.2-001: 区域数据包字段非法仍被接收

---

## 📊 十大典型问题覆盖表

| 编号 | 问题描述 | 测试用例 | 严重级别 |
|------|---------|---------|---------|
| 2.2-002 | 非"准备投镖"状态仍能接收飞镖输入 | 6_状态机测试 | 🔴 高 |
| 2.3-001 | 点击"开始"后无倒计时启动 | 6_状态机测试 | 🔴 高 |
| 2.4-001 | 轻镖命中"内牛眼"得分错误 | 5_得分逻辑测试 | 🔴 高 |
| 2.4-002 | 重镖命中"三倍区"得分错误 | 5_得分逻辑测试 | 🔴 高 |
| 2.5-001 | 时间结束后仍接收得分信息 | 6_状态机测试 | 🔴 高 |
| 2.6-001 | 非"投镖结束"状态下点击"复位"仍清空数据 | 6_状态机测试 | 🟡 中 |
| 3.1-001 | 校验错误数据帧未被丢弃（接口1） | 3_接口校验 + 8_异常测试 | 🔴 高 |
| 3.2-001 | 区域数据包字段非法仍被接收（接口2） | 4_接口校验 + 8_异常测试 | 🔴 高 |
| 2.5-002 | 成绩评定分区错误（轻镖平均2分显示"差"） | 7_成绩评定测试 | 🟡 中 |
| 2.2-003 | 飞镖数量字段为nil时系统崩溃 | 8_异常数据测试 | 🔴 高 |

**统计**:
- 🔴 高严重级别: 8个
- 🟡 中严重级别: 2个
- 总计: 10个

---

## 🗂️ 测试数据配置 (`data.yml`)

### 文件位置
`testdata/data.yml`

### 数据结构
```yaml
shoot:                      # 飞镖输入测试数据
  - type: 1                 # 轻型飞镖
    number: 10
  - type: 2                 # 重型飞镖
    number: 5

target:                     # 靶区接收测试数据
  - zone: 1                 # 内牛眼
  - zone: 5                 # 三倍区
  - zone: 10                # 普通区

scoring_tests:              # 得分逻辑测试数据
  - dart_type: 1
    zone: 1
    expected_score: 5       # 轻镖-内牛眼：5分

performance_tests:          # 成绩评定测试数据
  - total_score: 20
    average_score: 2.0
    expected_grade: "良"    # 平均2分应为"良"

exception_tests:            # 异常数据测试
  - dart_number: null       # nil值测试
  - zone: 0                 # 无效区域
```

---

## 🚀 使用方法

### 1. 运行单个测试
在测试平台中选择对应的 `.run` 文件执行：
- `run/1shoot.run` - 飞镖输入测试
- `run/2target.run` - 靶区接收测试
- `run/3interface_shoot.run` - 数据传送机接口测试
- `run/4interface_target.run` - 靶体接口测试
- `run/5scoring_test.run` - 得分逻辑测试 ⭐
- `run/6state_machine_test.run` - 状态机测试 ⭐
- `run/7performance_test.run` - 成绩评定测试 ⭐
- `run/8exception_test.run` - 异常数据测试 ⭐

### 2. 测试顺序建议
1. 基础功能测试（1-2）
2. 接口校验测试（3-4）
3. 核心逻辑测试（5-7）
4. 异常处理测试（8）

### 3. 测试交互说明
- 大部分测试需要手动观察系统行为并回答是/否
- 部分测试需要手动操作系统（如点击按钮、复位等）
- 测试过程中会显示详细的步骤和预期结果
- 每个测试结束会显示通过/失败统计

---

## 📈 评分与覆盖率

### 覆盖率目标
- ✅ 功能覆盖率: 100%
- ✅ 接口覆盖率: 100%
- ✅ 状态覆盖率: 100%
- ✅ 异常覆盖率: 100%

### 问题发现率
- 已识别问题: 10个
- 测试覆盖: 10/10 (100%)

---

## 📝 测试报告模板

### 测试执行记录
```
测试日期: ________
测试人员: ________
被测系统版本: ________

测试结果汇总:
  1. 飞镖信息输入: [ ] 通过 [ ] 失败
  2. 靶区信息接收: [ ] 通过 [ ] 失败
  3. 数据传送机接口: [ ] 通过 [ ] 失败
  4. 靶体接口: [ ] 通过 [ ] 失败
  5. 得分逻辑: [ ] 通过 [ ] 失败
  6. 状态机: [ ] 通过 [ ] 失败
  7. 成绩评定: [ ] 通过 [ ] 失败
  8. 异常数据处理: [ ] 通过 [ ] 失败

发现问题列表:
  问题编号    | 问题描述                        | 严重程度 | 状态
  ------------|--------------------------------|---------|------
  2.4-001     | 轻镖内牛眼得分错误              | 高      | [ ]
  2.4-002     | 重镖三倍区得分错误              | 高      | [ ]
  2.2-002     | 非准备状态仍能接收飞镖          | 高      | [ ]
  ...         | ...                            | ...     | ...

总体评价: __________
```

---

## 🔧 故障排查

### 常见问题

**Q1: 测试脚本执行后无反应？**  
A: 检查 `.run` 文件中的路径配置是否正确，确保 `luaVal` 和 `yamlVal` 指向正确的文件。

**Q2: 数据包发送失败？**  
A: 检查通道配置是否正确，确保 `COM_shoot` 和 `COM_target` 通道已正确配置。

**Q3: 测试结果与预期不符？**  
A: 这可能表示系统存在问题，请详细记录测试步骤和实际结果，提交问题报告。

**Q4: 如何验证得分是否正确？**  
A: 参考得分规则：
- 轻镖：内牛眼5分，外牛眼3分，三倍区2分，普通区1分
- 重镖：内牛眼3分，外牛眼2分，三倍区2分，普通区1分

---

## 📧 联系与反馈

如有测试相关问题或建议，请：
1. 查阅本文档的故障排查章节
2. 检查测试日志输出
3. 提交详细的问题报告

---

**文档版本**: v2.0  
**最后更新**: 2025年  
**作者**: 测试开发团队
